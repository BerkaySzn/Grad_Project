{% extends "base.html" %}

{% block title %}Object Detection API{% endblock %}

{% block content %}
<div class="container">
    <h1>Object Detection API</h1>
    
    <form id="uploadForm">
        Upload Image <input type="file" id="imageInput" accept="image/*" required>
        <input type="submit" value="Upload">
    </form>

    <div id="results" style="display: none;">
        <div class="row mt-4">
            <div class="col-12">
                <h2>We detected your ingredients!!</h2>
                <div class="row">
                    <div class="col-md-6">
                        <div class="border p-3">
                            <div id="ingredientList"></div>
                        </div>
                        <button onclick="document.getElementById('results').style.display='none'" class="btn btn-outline-secondary mt-3">See all</button>
                    </div>
                    <div class="col-md-6">
                        <div class="text-center">
                            <h3>Let's get the recipes</h3>
                            <button class="btn btn-primary mt-3" onclick="window.location.href='/recipes'">Go to recipes</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    document.getElementById('uploadForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        
        const formData = new FormData();
        const imageFile = document.getElementById('imageInput').files[0];
        formData.append('image', imageFile);

        try {
            const response = await fetch('/upload-image', {
                method: 'POST',
                body: formData
            });

            const data = await response.json();
            
            if (data.error) {
                alert(data.error);
                return;
            }

            // Display results
            document.getElementById('results').style.display = 'block';
            
            // Display ingredients
            const ingredientList = document.getElementById('ingredientList');
            ingredientList.innerHTML = '';
            data.ingredients.forEach(ingredient => {
                const div = document.createElement('div');
                div.className = 'ingredient-item';
                div.textContent = `-${ingredient.name} (${(ingredient.confidence * 100).toFixed(0)})`;
                ingredientList.appendChild(div);
            });

        } catch (error) {
            alert('Error uploading image. Please try again.');
            console.error('Error:', error);
        }
    });
</script>
{% endblock %}
